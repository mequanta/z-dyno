curl 'https://www.quantopian.com/backtests/start_ide_backtest' -H 'origin: https://www.quantopian.com' -H 'accept-encoding: gzip, deflate' -H 'x-csrf-token: k/9EehbwCp+eHvuVm5UJrxVNXfVSe537gWJuhuoXN5I=' -H 'accept-language: en-US,en;q=0.8' -H 'x-requested-with: XMLHttpRequest' -H 'cookie: __cfduid=de68d8bd619f4eba646ca639b330db6281446862608; quanto_session_id=session_563de2d4d6cbc4dce10003c2; vanity_id=6995e4081175ec0d46fa39b47a42f5fb; quanto_referrer=https%3A%2F%2Fwww.quantopian.com%2F; remember_user_token=BAhbB1sGVToaTW9wZWQ6OkJTT046Ok9iamVjdElkIhFTNrvSv7psuPAAAlZJIiIkMmEkMTAkS3YvQlcyZzNpTGNnbU0yVEd6ZTdVTwY6BkVU--0abdcce44aa8d6830987594397433aa4b0d2e34e; quanto_device=3418422fa3bd17335e5d4cf5bc1e68ff; _qf_session=BAh7CUkiD3Nlc3Npb25faWQGOgZFVEkiJTAwNGUxZTI4Yjc1YjE3MmZmMzk5YThiNTljYWFiNTI1BjsAVEkiGXdhcmRlbi51c2VyLnVzZXIua2V5BjsAVFsHWwZVOhpNb3BlZDo6QlNPTjo6T2JqZWN0SWQiEVM2u9K%2Fumy48AACVkkiIiQyYSQxMCRLdi9CVzJnM2lMY2dtTTJUR3plN1VPBjsAVEkiHXdhcmRlbi51c2VyLnVzZXIuc2Vzc2lvbgY7AFR7BjoVYXV0aGVudGljYXRlZF9hdEl1OglUaW1lDevoHIBMzRWtCjoJem9uZUkiCFVUQwY7AFQ6DW5hbm9fbnVtaQG3Og1uYW5vX2RlbmkGOg1zdWJtaWNybyIHGDA6C29mZnNldGkASSIQX2NzcmZfdG9rZW4GOwBGSSIxay85RWVoYndDcCtlSHZ1Vm01VUpyeFZOWGZWU2U1MzdnV0p1aHVvWE41ST0GOwBG--a71390e5e6d323ec990e937b790bbea9b1d174fa; community_home=%2Fposts; _safe_cookies__known_cookies=quanto_referrer%7Cquanto_session_id%7Cvanity_id%7C_qf_session%7Cremember_user_token%7Cquanto_device%7Cquanto_guest_id%7Clive_algo_filter; live_algo_filter=running; secured_old_cookies=Sat%2C+07+Nov+2015+11%3A51%3A39+-0000; first_session=%7B%22visits%22%3A13%2C%22start%22%3A1446896343964%2C%22last_visit%22%3A1446897879319%2C%22url%22%3A%22https%3A%2F%2Fwww.quantopian.com%2F%22%2C%22path%22%3A%22%2F%22%2C%22referrer%22%3A%22%22%2C%22referrer_info%22%3A%7B%22host%22%3A%22www.quantopian.com%22%2C%22path%22%3A%22%2F%22%2C%22protocol%22%3A%22https%3A%22%2C%22port%22%3A80%2C%22search%22%3A%22%22%2C%22query%22%3A%7B%7D%7D%2C%22search%22%3A%7B%22engine%22%3Anull%2C%22query%22%3Anull%7D%2C%22prev_visit%22%3A1446897807233%2C%22time_since_last_visit%22%3A72086%2C%22version%22%3A0.4%7D; quanto_ide_main_splitter=714px; __utmt=1; __utma=116492422.1660107223.1446896354.1446896354.1446896354.1; __utmb=116492422.8.10.1446896354; __utmc=116492422; __utmz=116492422.1446896354.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); mp_75873953cd404bcc1da88a55ff51e3b4_mixpanel=%7B%22distinct_id%22%3A%20%225336bbd2bfba6cb8f0000256%22%2C%22%24initial_referrer%22%3A%20%22%24direct%22%2C%22%24initial_referring_domain%22%3A%20%22%24direct%22%2C%22__mps%22%3A%20%7B%7D%2C%22__mpso%22%3A%20%7B%7D%2C%22__mpa%22%3A%20%7B%7D%2C%22__mpu%22%3A%20%7B%7D%2C%22__mpap%22%3A%20%5B%5D%2C%22%24email%22%3A%20%227939754%40qq.com%22%7D' -H 'pragma: no-cache' -H 'user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.80 Safari/537.36' -H 'content-type: application/x-www-form-urlencoded; charset=UTF-8' -H 'accept: */*' -H 'cache-control: no-cache' -H 'referer: https://www.quantopian.com/algorithms/563383c956e023a6f70004cb' --data $'algo_id=563383c956e023a6f70004cb&backtest_start_date_year=2015&backtest_start_date_month=9&backtest_start_date_day=28&backtest_end_date_year=2015&backtest_end_date_month=10&backtest_end_date_day=28&backtest_capital_base=1000000&backtest_data_frequency_value=minute&code=%23+This+is+a+sample+mean-reversion+algorithm+on+Quantopian+for+you+to+test+and+adapt.%0A%0A%23+Algorithm+investment+thesis%3A+%0A%23+Top-performing+stocks+from+last+week+will+do+worse+this+week%2C+and+vice-versa.%0A%0A%23+Every+Monday%2C+we+rank+high-volume+stocks+based+on+their+previous+5+day+returns.+%0A%23+We+go+long+the+bottom+20%25+of+stocks+with+the+WORST+returns+over+the+past+5+days.%0A%23+We+go+short+the+top+20%25+of+stocks+with+the+BEST+returns+over+the+past+5+days.%0A%0A%23+This+type+of+algorithm+may+be+used+in+live+trading+and+in+the+Quantopian+Open.%0A%0A%23+Import+the+libraries+we+will+use+here%0Aimport+numpy+as+np%0A%0A%23+The+initialize+function+is+the+place+to+set+your+tradable+universe+and+define+any+parameters.+%0Adef+initialize(context)%3A%0A++++%23+Use+the+top+1%25+of+stocks+defined+by+average+daily+trading+volume.%0A++++set_universe(universe.DollarVolumeUniverse(99%2C+100))%0A++++%0A++++%23+Set+execution+cost+assumptions.+For+live+trading+with+Interactive+Brokers+%0A++++%23+we+will+assume+a+%241.00+minimum+per+trade+fee%2C+with+a+per+share+cost+of+%240.0075.+%0A++++set_commission(commission.PerShare(cost%3D0.0075%2C+min_trade_cost%3D1.00))%0A++++%0A++++%23+Set+market+impact+assumptions.+We+limit+the+simulation+to+%0A++++%23+trade+up+to+2.5%25+of+the+traded+volume+for+any+one+minute%2C%0A++++%23+and++our+price+impact+constant+is+0.1.+%0A++++set_slippage(slippage.VolumeShareSlippage(volume_limit%3D0.025%2C+price_impact%3D0.10))%0A++++%0A++++%23+Define+the+other+variables%0A++++context.long_leverage+%3D+0.5%0A++++context.short_leverage+%3D+-0.5%0A++++context.lower_percentile+%3D+20%0A++++context.upper_percentile+%3D+80%0A++++context.returns_lookback+%3D+5%0A+++++++++++%0A++++%23+Rebalance+every+Monday+(or+the+first+trading+day+if+it\'s+a+holiday).%0A++++%23+At+11AM+ET%2C+which+is+1+hour+and+30+minutes+after+market+open.%0A++++schedule_function(rebalance%2C+%0A++++++++++++++++++++++date_rules.week_start(days_offset%3D0)%2C%0A++++++++++++++++++++++time_rules.market_open(hours+%3D+1%2C+minutes+%3D+30))++%0A%0A%23+The+handle_data+function+is+run+every+bar.++++%0Adef+handle_data(context%2Cdata)%3A++++%0A++++%23+Record+and+plot+the+leverage+of+our+portfolio+over+time.+%0A++++record(leverage+%3D+context.account.leverage)%0A%0A++++%23+We+also+want+to+monitor+the+number+of+long+and+short+positions+%0A++++%23+in+our+portfolio+over+time.+This+loop+will+check+our+positition+sizes+%0A++++%23+and+add+the+count+of+longs+and+shorts+to+our+plot.%0A++++longs+%3D+shorts+%3D+0%0A++++for+position+in+context.portfolio.positions.itervalues()%3A%0A++++++++if+position.amount+%3E+0%3A%0A++++++++++++longs+%2B%3D+1%0A++++++++if+position.amount+%3C+0%3A%0A++++++++++++shorts+%2B%3D+1%0A++++record(long_count%3Dlongs%2C+short_count%3Dshorts)%0A%0A%23+This+rebalancing+is+called+according+to+our+schedule_function+settings.+++++%0Adef+rebalance(context%2Cdata)%3A%0A++++%23+Get+the+last+N+days+of+prices+for+every+stock+in+our+universe.%0A++++prices+%3D+history(context.returns_lookback%2C+\'1d\'%2C+\'price\')%0A++++%0A++++%23+Calculate+the+past+5+days\'+returns+for+each+security.%0A++++returns+%3D+(prices.iloc%5B-1%5D+-+prices.iloc%5B0%5D)+%2F+prices.iloc%5B0%5D%0A++++%0A++++%23+Remove+stocks+with+missing+prices.%0A++++%23+Remove+any+stocks+we+ordered+last+time+that+still+have+open+orders.%0A++++%23+Get+the+cutoff+return+percentiles+for+the+long+and+short+portfolios.%0A++++returns+%3D+returns.dropna()%0A++++open_orders+%3D+get_open_orders()%0A++++if+open_orders%3A%0A++++++++eligible_secs+%3D+%5Bsec+for+sec+in+data+if+sec+not+in+open_orders%5D%0A++++++++returns+%3D+returns%5Beligible_secs%5D%0A%0A++++%23+Lower+percentile+is+the+threshhold+for+the+bottom+20%25%2C+upper+percentile+is+for+the+top+20%25.%0A++++lower%2C+upper+%3D+np.percentile(returns%2C+%5Bcontext.lower_percentile%2C%0A+++++++++++++++++++++++++++++++++++++++++++context.upper_percentile%5D)%0A++++%0A++++%23+Select+the+X%25+worst+performing+securities+to+go+long.%0A++++long_secs+%3D+returns%5Breturns+%3C%3D+lower%5D%0A++++%0A++++%23+Select+the+Y%25+best+performing+securities+to+short.%0A++++short_secs+%3D+returns%5Breturns+%3E%3D+upper%5D%0A++++%0A++++%23+Set+the+allocations+to+even+weights+in+each+portfolio.%0A++++long_weight+%3D+context.long_leverage+%2F+len(long_secs)%0A++++short_weight+%3D+context.short_leverage+%2F+len(short_secs)%0A++++%0A++++for+security+in+data%3A%0A++++++++%0A++++++++%23+Buy%2Frebalance+securities+in+the+long+leg+of+our+portfolio.%0A++++++++if+security+in+long_secs%3A%0A++++++++++++order_target_percent(security%2C+long_weight)%0A++++++++++++%0A++++++++%23+Sell%2Frebalance+securities+in+the+short+leg+of+our+portfolio.%0A++++++++elif+security+in+short_secs%3A%0A++++++++++++order_target_percent(security%2C+short_weight)%0A++++++++++++%0A++++++++%23+Close+any+positions+that+fell+out+of+the+list+of+securities+to+long+or+short.%0A++++++++else%3A%0A++++++++++++order_target(security%2C+0)%0A++++++++++++%0A++++log.info(%22This+week\'s+longs%3A+%22%2B%22%2C+%22.join(%5Blong_.symbol+for+long_+in+long_secs.index%5D))%0A++++log.info(%22This+week\'s+shorts%3A+%22++%2B%22%2C+%22.join(%5Bshort_.symbol+for+short_+in+short_secs.index%5D))%0A' --compressed -k